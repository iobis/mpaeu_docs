# Obtaining occurrence data from OBIS and GBIF

## Selecting species for modeling

The first step was to establish the species occurring on the study area. We used the `robis` function `dataset` to retrieve all species occurring on the study area. Further on we filtered the dataset to:

- retain only taxa at the species level
- retain only taxa with accepted taxonomic status
- remove Archaea, Bacteria, Fungi and Protozoa taxa
- include only marine or brackish species

From that we obtained a final list of [27112]{style="color: #006fdf"} species.

## Downloading data

OBIS data was obtained from the full export available at [https://obis.org/data/access/](https://obis.org/data/access/).

GBIF data was downloaded through the `rgbif` package. We limited the number of downloaded records to 30000 [TO VERIFY IF COULD BE CIRCUMVENTED].

## Quality control steps

### Duplicate records removal

We removed duplicated data points using [GeoHash](https://www.ibm.com/docs/en/streams/4.3.0?topic=334-geohashes) with a precision of 6 (width â‰¤ 1.22km X height 0.61km), and the year. Thus, for each combination of GeoHash cell and year, only one record was kept. That part is implemented in the `mp_dup_check` function, of the project package `msdm`.

::: {.callout-note}
We note that, specifically for the SDMs, before modeling we do an additional duplicate removal in order to keep only a single record per cell.
:::

### Remove records on land

Records on land were removed based on [TODO - see if use GHRSS or openmap].

::: {.callout-note}
We further filtered the records for the SDMs by keeping only those overlapping the environmental variable layers (which present some differences to the land layer used before).
:::

### Geographical outliers (flagging)

The novelty of our approach is that for computing the distance between points we considered the existence of barriers. This is specially important for marine species. So for example, the distance between a point on the Pacific side of the Panama strait, and on the Atlantic side, would be XXX when considering only the cartesian distance. However, when we consider the barrier, the distance is of XXX.

### Environmental outliers (flagging)