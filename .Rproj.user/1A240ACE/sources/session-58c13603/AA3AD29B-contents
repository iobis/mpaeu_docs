#' Retrieve species names occurring on a certain area
#'
#' @param starea the study area. An sf or Spatial* shape.
#' @param boundary logical. If TRUE, the bounding box of the `starea` is 
#'extracted and is used as the geometry for delimiting the area of the 
#'checklist. NOTE: if you have a complex shape, then it's strongly advised that 
#'you set `boundary` to TRUE.
#'
#' @return a data frame with the species occurring on the study area, according to OBIS.
#' @export
#' 
#'@seealso [robis::checklist()] 
#'
#' @examples
mp_get_species <- function(starea,
                           boundary = TRUE) {
  
  if (!inherits(starea, "sf")) {
    try(starea <- st_as_sf(starea))
    if (inherits(starea, "try-error")) {
      stop("Study area shapefile should be of type sf or SpatialPolygons*")
    }
  }
  
  if (boundary) {
    starea <- st_as_sfc(st_bbox(starea))
  }
  
  starea <- st_as_text(st_geometry(starea))
  
  sp_list <- try(robis::checklist(
    geometry = starea
  ))
  
  if (inherits(sp_list, "try-error")) {
    stop("Checklist failed. Try a simpler WKT or use boundary = T to get the bounding box.")
  } else {
    sp_list <- sp_list[sp_list$taxonRank == "Species", ]
    return(sp_list)
  }
  
}
